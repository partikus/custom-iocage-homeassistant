#!/usr/bin/env bash

plugin='/root/.plugin/pip'
install -d -m 775 -- "${plugin}" || exit 1

get_pip_required() {
  local service="${1:-none}"
  local R required="${plugin}/requirements.${service}"
  local C constraints="${plugin}/constraints.${service}"
  rm -f "${required}" "${constraints}"
  ## HOME-ASSISTANT-CORE -----------------------------
  if [ "${service}" == "homeassistant" ]; then
    R="https://raw.githubusercontent.com/home-assistant/core/master/requirements.txt"
    C="https://raw.githubusercontent.com/home-assistant/core/master/homeassistant/package_constraints.txt"
    curl -so "${constraints}" ${C} \
      && curl -s ${R} | sed "s|homeassistant/package_constraints.txt|${constraints}|" > "${required}"
    return $?
  fi
}

get_pip_required "${1}"
